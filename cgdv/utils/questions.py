# utils/__init__.py
"""ĞŸĞ°ĞºĞµÑ‚ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚"""

# utils/questions.py
"""
ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ°Ğ½ĞºĞµÑ‚Ñ‹
Ğ—Ğ”Ğ•Ğ¡Ğ¬ Ğ›Ğ•Ğ“ĞšĞ Ğ˜Ğ—ĞœĞ•ĞĞ˜Ğ¢Ğ¬ Ğ’Ğ¡Ğ• Ğ’ĞĞŸĞ ĞĞ¡Ğ«
"""

from typing import Dict, Any, Callable

# ============================================================================
# ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ Ğ’ĞĞŸĞ ĞĞ¡ĞĞ’ ĞĞĞšĞ•Ğ¢Ğ« - Ğ˜Ğ—ĞœĞ•ĞĞ¯Ğ™Ğ¢Ğ• Ğ—Ğ”Ğ•Ğ¡Ğ¬!
# ============================================================================

PROFILE_QUESTIONS: Dict[str, Dict[str, Any]] = {
    "name": {
        "text": "ğŸ‘¤ ĞšĞ°Ğº Ğ²Ğ°Ñ Ğ·Ğ¾Ğ²ÑƒÑ‚ Ğ¸Ğ»Ğ¸ ĞºĞ°ĞºĞ¾Ğ¹ Ñƒ Ğ²Ğ°Ñ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ½Ğ¸Ğº?",
        "validation": lambda x: len(x.strip()) >= 2 and len(x.strip()) <= 50,
        "error": "âŒ Ğ˜Ğ¼Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¾Ñ‚ 2 Ğ´Ğ¾ 50 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²"
    },
    
    "age": {
        "text": "ğŸ‚ Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°Ğ¼ Ğ»ĞµÑ‚? (16-99)",
        "validation": lambda x: x.isdigit() and 16 <= int(x) <= 99,
        "error": "âŒ Ğ’Ğ¾Ğ·Ñ€Ğ°ÑÑ‚ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼ Ğ¾Ñ‚ 16 Ğ´Ğ¾ 99",
        "process": lambda x: int(x)  # ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·ÑƒĞµĞ¼ Ğ² Ñ‡Ğ¸ÑĞ»Ğ¾
    },
    
    "bio": {
        "text": "ğŸ“ Ğ Ğ°ÑÑĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¾ ÑĞµĞ±Ğµ (Ñ‡Ñ‚Ğ¾ Ğ»ÑĞ±Ğ¸Ñ‚Ğµ Ğ² Ğ¸Ğ³Ñ€Ğ°Ñ…, ĞºĞ°Ğº Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚Ğµ Ğ²Ñ€ĞµĞ¼Ñ)",
        "validation": lambda x: len(x.strip()) >= 10 and len(x.strip()) <= 500,
        "error": "âŒ Ğ Ğ°ÑÑĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ Ğ¾ ÑĞµĞ±Ğµ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ (Ğ¾Ñ‚ 10 Ğ´Ğ¾ 500 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)"
    },
    
    "games": {
        "text": "ğŸ® Ğ’ ĞºĞ°ĞºĞ¸Ğµ Ğ¸Ğ³Ñ€Ñ‹ Ğ²Ñ‹ Ğ¸Ğ³Ñ€Ğ°ĞµÑ‚Ğµ?",
        "type": "keyboard",
        "options": {
            "dota2": "ğŸ® Dota 2",
            "cs2": "ğŸ”« CS2", 
            "both": "ğŸ¯ ĞĞ±Ğµ Ğ¸Ğ³Ñ€Ñ‹",
            "other": "ğŸ² Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¸Ğ³Ñ€Ñ‹"
        }
    },
    
    "skill_level": {
        "text": "ğŸ† Ğ’Ğ°Ñˆ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¸Ğ³Ñ€Ñ‹?",
        "type": "keyboard", 
        "options": {
            "beginner": "ğŸŸ¢ ĞĞ¾Ğ²Ğ¸Ñ‡Ğ¾Ğº",
            "casual": "ğŸŸ¡ Ğ›ÑĞ±Ğ¸Ñ‚ĞµĞ»ÑŒ", 
            "advanced": "ğŸŸ  ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğ¹",
            "pro": "ğŸ”´ ĞŸÑ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹"
        }
    },
    
    "play_time": {
        "text": "â° ĞšĞ¾Ğ³Ğ´Ğ° Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¸Ğ³Ñ€Ğ°ĞµÑ‚Ğµ?",
        "type": "keyboard",
        "options": {
            "morning": "ğŸŒ… Ğ£Ñ‚Ñ€Ğ¾Ğ¼",
            "day": "â˜€ï¸ Ğ”Ğ½ĞµĞ¼",
            "evening": "ğŸŒ† Ğ’ĞµÑ‡ĞµÑ€Ğ¾Ğ¼", 
            "night": "ğŸŒ™ ĞĞ¾Ñ‡ÑŒÑ",
            "flexible": "ğŸ• Ğ’ Ğ»ÑĞ±Ğ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ"
        }
    }
}

# ============================================================================
# Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ Ğ”Ğ›Ğ¯ Ğ ĞĞ‘ĞĞ¢Ğ« Ğ¡ Ğ’ĞĞŸĞ ĞĞ¡ĞĞœĞ˜
# ============================================================================

def get_question_keys() -> list:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ĞºĞ»ÑÑ‡ĞµĞ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ"""
    return list(PROFILE_QUESTIONS.keys())

def get_question(key: str) -> Dict[str, Any]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° Ğ¿Ğ¾ ĞºĞ»ÑÑ‡Ñƒ"""
    return PROFILE_QUESTIONS.get(key, {})

def validate_answer(question_key: str, answer: str) -> tuple[bool, str]:
    """
    Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ (ÑƒÑĞ¿ĞµÑ…, ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ)
    """
    question = get_question(question_key)
    
    if not question:
        return False, "âŒ ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ"
    
    validation_func = question.get('validation')
    if validation_func and not validation_func(answer):
        return False, question.get('error', 'âŒ ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚')
    
    return True, ""

def process_answer(question_key: str, answer: str) -> Any:
    """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ¿Ñ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ¾Ğ²)"""
    question = get_question(question_key)
    process_func = question.get('process')
    
    if process_func:
        return process_func(answer)
    
    return answer

def is_keyboard_question(question_key: str) -> bool:
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ»Ğ¸ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ"""
    question = get_question(question_key)
    return question.get('type') == 'keyboard'

def get_keyboard_options(question_key: str) -> Dict[str, str]:
    """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¾Ğ¿Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñ‹"""
    question = get_question(question_key)
    return question.get('options', {})

# ============================================================================
# ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« ĞĞĞ’Ğ«Ğ¥ Ğ’ĞĞŸĞ ĞĞ¡ĞĞ’ (Ğ ĞĞ¡ĞšĞĞœĞœĞ•ĞĞ¢Ğ˜Ğ Ğ£Ğ™Ğ¢Ğ• Ğ˜ Ğ”ĞĞ‘ĞĞ’Ğ¬Ğ¢Ğ• Ğ’ PROFILE_QUESTIONS)
# ============================================================================

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ:

EXAMPLE_QUESTIONS = {
    # Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸ĞµĞ¹ Steam ID
    "steam_id": {
        "text": "ğŸ”— Ğ’Ğ°Ñˆ Steam ID (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ´Ğ»Ñ Ğ²ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸)",
        "validation": lambda x: len(x) == 0 or (len(x) >= 5 and x.isdigit()),
        "error": "âŒ Steam ID Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ†Ğ¸Ñ„Ñ€Ñ‹",
        "optional": True  # ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ
    },
    
    # Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¾ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾Ğ¹ Ñ€Ğ¾Ğ»Ğ¸
    "preferred_role": {
        "text": "ğŸ¯ ĞšĞ°ĞºÑƒÑ Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ñ€ĞµĞ´Ğ¿Ğ¾Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚Ğµ?",
        "type": "keyboard",
        "options": {
            "support": "ğŸ›¡ï¸ Support",
            "carry": "âš”ï¸ Carry",
            "mid": "ğŸ”¥ Mid", 
            "offlane": "ğŸŒ² Offlane",
            "flex": "ğŸ® Ğ›ÑĞ±ÑƒÑ"
        }
    },
    
    # Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¾ Ñ†ĞµĞ»ÑÑ… Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼ÑÑ‚Ğ²Ğ°
    "looking_for": {
        "text": "ğŸ¯ Ğ§Ñ‚Ğ¾ Ğ¸Ñ‰ĞµÑ‚Ğµ?",
        "type": "keyboard",
        "options": {
            "teammate": "ğŸ‘¥ Ğ¢Ğ¸Ğ¼Ğ¼ĞµĞ¹Ñ‚Ğ°",
            "friend": "ğŸ¤ Ğ”Ñ€ÑƒĞ³Ğ°",
            "coach": "ğŸ“š Ğ¢Ñ€ĞµĞ½ĞµÑ€Ğ°",
            "student": "ğŸ“ Ğ£Ñ‡ĞµĞ½Ğ¸ĞºĞ°",
            "relationship": "ğŸ’• ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ"
        }
    },
    
    # Ğ’Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¾ ÑĞ·Ñ‹ĞºĞ°Ñ…
    "languages": {
        "text": "ğŸ—£ï¸ ĞĞ° ĞºĞ°ĞºĞ¸Ñ… ÑĞ·Ñ‹ĞºĞ°Ñ… Ğ¾Ğ±Ñ‰Ğ°ĞµÑ‚ĞµÑÑŒ?",
        "type": "keyboard", 
        "options": {
            "ru": "ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹",
            "en": "ğŸ‡ºğŸ‡¸ English",
            "both": "ğŸŒ Ğ ÑƒÑÑĞºĞ¸Ğ¹ + English",
            "other": "ğŸ—ºï¸ Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ"
        }
    }
}